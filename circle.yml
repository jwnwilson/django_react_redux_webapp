version: 2
jobs:
  build-be:
    working_directory: /app
    docker:
      - image: python
    environment:
      PIPENV_VENV_IN_PROJECT: "True"
    steps:
      - checkout
      - restore_cache:
          key: v1-be-{{ checksum "Pipfile.lock" }}
          paths:
            - /app/src/server/.venv
      - run:
          command: 'make setup-be'
      - save_cache:
          key: v1-be-{{ checksum "Pipfile.lock" }}
          paths:
            - /app/src/server/.venv
      - run:
          command: 'make test-be'
  build-fe:
    working_directory: /app
    docker:
      - image: node:6.11.2
    steps:
      - checkout
      - restore_cache:
          key: v1-fe-{{ checksum "client/package.json" }}
          paths:
            - /app/src/client/node_modules
      - run:
          command: 'make setup-fe'
      - save_cache:
          key: v1-fe-{{ checksum "client/package.json" }}
          paths:
            - /app/src/client/node_modules
      - run:
          command: 'make test-fe'
workflows:
  version: 2
  build:
    jobs:
      - build-fe
      - build-be
